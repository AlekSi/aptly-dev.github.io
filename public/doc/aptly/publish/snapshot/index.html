<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>aptly publish snapshot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <link type="text/css" rel="stylesheet" href="/css/styles.css">
    <link rel="canonical" href="http://localhost:1313/doc/aptly/publish/snapshot">
    <link href="" rel="alternate" type="application/rss+xml" title="aptly - Debian repository management tool" />
    
  </head>
  <body>
    <header id="page-header">
      <div class="container">
                <nav class="navbar navbar-default navbar-static-top" role="navigation">
          <ul class="nav navbar-nav nav-justified">
            <li><a href="/examples/">examples</a> doc</li>
            <li ><a href="/download/">download</a></li>
            <li><a href="/support/">support</a></li>
            <li class="active"><a href="/doc/">documentation</a></li>
            <li ><a href="/about/">about</a></li>
            <li ><a href="/post/">blog</a></li>
          </ul>
        </nav>

        <div class="row">
          <div class="col-md-6 col-md-offset-3 text-center">
            <div class="brand">
              <i class="brand-logo"></i>
              <span class="brand-name">aptly</span>
            </div>
          </div>
        </div>
      
      </div>
    </header>

    
    <section class="documentation">
      <div class="container">
        <div class="sidebar-overlay"></div>
        <div class="row">
          <div class="col-md-3 col-sm-3 col-xs-3">
            <div class="sidebar">
              <ul class="nav nav-sidebar">
                
                
                  <li >
                    <a href="http://localhost:1313/doc/overview">Overview</a>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/why">Why aptly?</a>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/commands">Commands</a>
                    
                      <ul class="nav">
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/mirror">aptly mirror</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/create">aptly mirror create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/update">aptly mirror update</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/list">aptly mirror list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/show">aptly mirror show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/edit">aptly mirror edit</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/rename">aptly mirror rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/drop">aptly mirror drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/repo">aptly repo</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/create">aptly repo create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/add">aptly repo add</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/import">aptly repo import</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/show">aptly repo show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/list">aptly repo list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/copy">aptly repo copy</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/move">aptly repo move</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/remove">aptly repo remove</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/edit">aptly repo edit</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/rename">aptly repo rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/drop">aptly repo drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/snapshot">aptly snapshot</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/create">aptly snapshot create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/list">aptly snapshot list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/show">aptly snapshot show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/verify">aptly snapshot verify</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/pull">aptly snapshot pull</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/diff">aptly snapshot diff</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/merge">aptly snapshot merge</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/rename">aptly snapshot rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/drop">aptly snapshot drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li class="active">
                            <a href="http://localhost:1313/doc/aptly/publish">aptly publish</a>
                            
                              <ul class="nav">
                                
                                  <li class="active">
                                    <a href="http://localhost:1313/doc/aptly/publish/snapshot">aptly publish snapshot</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/repo">aptly publish repo</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/update">aptly publish update</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/switch">aptly publish switch</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/list">aptly publish list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/drop">aptly publish drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/db">aptly db</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/db/cleanup">aptly db cleanup</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/db/recover">aptly db recover</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/serve">aptly serve</a>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/graph">aptly graph</a>
                            
                          </li>
                        
                      </ul>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/history">History</a>
                    
                  </li>
                
              </ul>
              <div class="source-buttons">
                <a href="/download/" class="btn btn-danger">Download</a>
                <a href="https://github.com/smira/aptly" class="btn btn-default">Github</a>
              </div>
            </div>
          </div>
          <div class="col-md-9 col-sm-9 col-xs-9">
            

<h2 id="toc_0">aptly publish snapshot</h2>

<p>Publishes snapshot as repository to be consumed by <code>apt</code>. Published
repostiories appear under <code>rootDir/public</code> directory. Valid <a href="#gpg-keys">GPG
key</a> is required for publishing.</p>

<p>Usage:</p>

<pre><code>$ aptly publish snapshot &lt;name&gt; [[&lt;endpoint:&gt;]&lt;prefix&gt;]
</code></pre>

<p>Params:</p>

<ul>
<li><code>name</code> is a snapshot name that snould be published</li>
<li><code>endpoint</code> is an optional endpoint reference. Without endpoint,
repository would be pulished to local file system. In order to
publish to Amazon S3, use endpoint name <code>s3:&lt;name&gt;:</code>, where endpoint
<code>name</code> is configured as S3 publishing endpoint in <a href="#s3-publishing">configuration
file</a>.</li>
<li><code>prefix</code> is an optional prefix for publishing, if not specified,
repository would be published to the root of public directory.
<code>prefix</code> could be single directory like <code>ppa</code> or part of the tree
like <code>ppa/android</code>. <code>prefix</code> shouldn&rsquo;t contain <code>..</code>, and names
<code>dists</code> and <code>pool</code> are not accepted. Empty <code>prefix</code> would be
converted to <code>.</code>.</li>
</ul>

<p>Flags:</p>

<ul>
<li><code>-component=&quot;&quot;</code>: component name to publish; guessed from original
repository (if any), or defaults to <code>main</code> (for multi-component
publishing, separate components with commas)</li>
<li><code>-distribution=&quot;&quot;</code>: distribution name to publish; guessed from
original repository distribution</li>
<li><code>-force-overwrite=false</code>: overwrite packages files in the pool even
if content is different (see also <a href="#duplicate-packages">duplicate
packages</a>)</li>
<li><code>-gpg-key=&quot;&quot;</code>: GPG key ID to use when signing the release, if not
specified default key is used</li>
<li><code>-keyring=&quot;&quot;</code>: GPG keyring to use (instead of default)</li>
<li><code>-label=&quot;&quot;</code>: value for <code>Label:</code> field</li>
<li><code>-origin=&quot;&quot;</code>: value for <code>Origin:</code> field</li>
<li><code>-secret-keyring=&quot;&quot;</code>: GPG secret keyring to use (instead of default)</li>
<li><code>-skip-signing=false</code>: don&rsquo;t sign Release files with GPG</li>
</ul>

<p>If architectures are limited (with config <code>architectures</code> or option
<code>-architectures</code>), only mentioned architectures would be published,
otherwise <code>aptly</code> will publish all architectures in the snapshot.</p>

<p><code>aptly</code> would try to figure out distribution and component from snapshot
by going via snapshot source tree down to mirrors and local
repositories. If all roots report the same distribution name, it is
chosen as default. If there are different distribution names or
distribution name is not specfied, <code>aptly</code> would display an error. For
component name the same rules apply except in case of not being able to
figure out component, aptly would use component <code>main</code>.</p>

<p>It is not allowed to publish two snapshots to the same <code>prefix</code> and
<code>distribution</code>.</p>

<p>Empty snapshots could be published as well (as placeholder, for
subsequent updates using <a href="#aptly-publish-switch">aptly publish switch</a>
command). When publishing empty snapshots it is important to specify
complete architectures list (using <code>-architectures</code> flag), as it can&rsquo;t
be changed after publishing.</p>

<p>Multiple component repositories should be published from several
snapshots, one snapshot per component. In case of multiple component
publishing, command accepts several snapshot names:</p>

<pre><code>$ aptly publish snapshot -component=main,contrib wheezy-main wheezy-contrib
</code></pre>

<p>When mirroring remote repositories in order to preserve package split by
component, create individual mirrors for each component, take snapshots
and publish them as multi-component repository.</p>

<p>Example:</p>

<pre><code>$ aptly publish snapshot back
Signing file '/var/aptly/public/dists/squeeze-backports/Release' with gpg, please enter your passphrase when prompted:

&lt;&lt;gpg asks for passphrase&gt;&gt;

Clearsigning file '/var/aptly/public/dists/squeeze-backports/Release' with gpg, please enter your passphrase when prompted:

&lt;&lt;gpg asks for passphrase&gt;&gt;

Snapshot back has been successfully published.
Please setup your webserver to serve directory '/var/aptly/public' with autoindexing.
Now you can add following line to apt sources:
  deb http://your-server/ squeeze-backports main
Don't forget to add your GPG key to apt with apt-key.
</code></pre>

<p>Directory structure for published repositories:</p>

<ul>
<li><code>&lt;rootDir&gt;</code>: <a href="#configuration">configuration</a> parameter, defaults to
<code>~/.aptly</code>

<ul>
<li><code>public/</code>: root of published tree (root for webserver)

<ul>
<li><code>dists/</code>

<ul>
<li><code>squeeze/</code>: distribution name

<ul>
<li><code>Release</code>: raw file</li>
<li><code>InRelease</code>: clearsigned version</li>
<li><code>Release.gpg</code>: detached <code>Release</code> signature</li>
<li><code>binary-i386</code>: binary packages index for
architecture <code>i386</code>

<ul>
<li><code>Packages</code>: package metadata</li>
<li><code>Packages.gz</code></li>
<li><code>Packages.bz2</code></li>
<li><code>Release</code>: used by debian-installer</li>
</ul></li>
<li><code>source</code>: source packages index (generated only if
source packages are available)

<ul>
<li><code>Sources</code>: package metadata</li>
<li><code>Sources.gz</code></li>
<li><code>Sources.bz2</code></li>
<li><code>Release</code>: used by debian-installer</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>pool/</code>

<ul>
<li><code>main/</code>: component main

<ul>
<li><code>m/</code>

<ul>
<li><code>mars-invaders/</code>

<ul>
<li><code>mars-invaders_1.0.3_i386.deb</code>: package file
(hard link to package from main pool)</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

          </div>
        </div>
      </div>
    </section>
    
    <footer id="page-footer">
      <div class="container">
                <nav class="navbar navbar-default navbar-static-top" role="navigation">
          <ul class="nav navbar-nav nav-justified">
            <li><a href="/examples/">examples</a> doc</li>
            <li ><a href="/download/">download</a></li>
            <li><a href="/support/">support</a></li>
            <li class="active"><a href="/doc/">documentation</a></li>
            <li ><a href="/about/">about</a></li>
            <li ><a href="/post/">blog</a></li>
          </ul>
        </nav>

        <div class="copy">
          &copy;&nbsp;Andrey Smirnov
        </div>
      </div>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  <script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
